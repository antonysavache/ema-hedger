# EMA Hedger Strategy v2.0

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

–¢–æ—Ä–≥–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è—Ö EMA —Å —É–º–Ω—ã–º —É—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ–º –∏ —Ö–µ–¥–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–æ–∑–∏—Ü–∏–π.

## üìä –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. **–û—Ç–∫—Ä—ã—Ç–∏–µ LONG –ø–æ–∑–∏—Ü–∏–π**
- **–ü–µ—Ä–≤–∏—á–Ω—ã–π –≤—Ö–æ–¥**: –ü—Ä–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ —Ü–µ–Ω—ã —á–µ—Ä–µ–∑ EMA —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö
- **–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ**: –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ü–µ–Ω—ã –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 1% –æ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã –ª–æ–Ω–≥–æ–≤ (—Ç–æ–ª—å–∫–æ –≤—ã—à–µ EMA)

### 2. **–û—Ç–∫—Ä—ã—Ç–∏–µ SHORT –ø–æ–∑–∏—Ü–∏–π (—Ö–µ–¥–∂–∏—Ä–æ–≤–∞–Ω–∏–µ)**
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ EMA —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑
- –†–∞–∑–º–µ—Ä —à–æ—Ä—Ç–∞ = –æ–±—ä–µ–º—É –≤—Å–µ—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ª–æ–Ω–≥–æ–≤
- –®–æ—Ä—Ç—ã –ù–ï —É—Å—Ä–µ–¥–Ω—è—é—Ç—Å—è - —Ç–æ–ª—å–∫–æ –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ

### 3. **–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π**
- **LONG**: –ü—Ä–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ EMA —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ —Å –æ–±—â–∏–º –ø—Ä–æ—Ñ–∏—Ç–æ–º
- **SHORT**: –ü—Ä–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ EMA —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤—Å–µ —à–æ—Ä—Ç—ã

### 4. **–£–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ö–µ–¥–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –Ω–∏–∂–µ EMA
- –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –¥–ª—è –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏
- –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ö–µ–¥–∂–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏

```typescript
const emaPeriod = 50;        // –ü–µ—Ä–∏–æ–¥ EMA
const orderSize = 100;       // –†–∞–∑–º–µ—Ä –æ—Ä–¥–µ—Ä–∞ –≤ USDT
const averagingThreshold = 1.0; // –ü–æ—Ä–æ–≥ –¥–ª—è —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è (%)
```

## üöÄ –ó–∞–ø—É—Å–∫ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
npm run start:dev
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
```bash
node test-strategy.js
```

### API Endpoints

#### GET /status
–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
```json
{
  "strategy": "EMA Hedger v2.0",
  "emaPeriod": 50,
  "orderSize": 100,
  "stats": {...},
  "activePositions": [...]
}
```

#### POST /process-kline
–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ–≤—É—é —Å–≤–µ—á—É
```json
{
  "symbol": "BTCUSDT",
  "open": "50000",
  "close": "50100",
  "high": "50200",
  "low": "49900",
  "volume": "1000"
}
```

#### POST /simulate-price-movement
–°–∏–º—É–ª—è—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–Ω—ã
```json
{
  "symbol": "BTCUSDT",
  "prices": [50000, 50100, 50200, ...]
}
```

## üìà –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã (–ø—Ä–∏–º–µ—Ä)

```
1. –¶–µ–Ω–∞: 49.5 ‚Üí 50.5 (–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ EMA —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö)
   ‚úÖ –û—Ç–∫—Ä—ã—Ç LONG 50.5

2. –¶–µ–Ω–∞: 50.5 ‚Üí 49.0 (–ø–∞–¥–µ–Ω–∏–µ –Ω–∏–∂–µ EMA)
   ‚úÖ –û—Ç–∫—Ä—ã—Ç HEDGE SHORT —Ä–∞–≤–Ω—ã–π –æ–±—ä–µ–º—É LONG

3. –¶–µ–Ω–∞: 49.0 ‚Üí 51.0 (–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ EMA —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö)
   ‚úÖ –ó–∞–∫—Ä—ã—Ç SHORT
   ‚úÖ –û—Ç–∫—Ä—ã—Ç –Ω–æ–≤—ã–π LONG 51.0

4. –¶–µ–Ω–∞: 51.0 ‚Üí 49.5 (–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ EMA —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑)
   ‚úÖ –ó–∞–∫—Ä—ã—Ç—ã –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ LONG (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö)
   ‚úÖ –î–ª—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è LONG –æ—Ç–∫—Ä—ã—Ç –Ω–æ–≤—ã–π HEDGE SHORT
```

## üìã –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### PartialCloseResult
–£–º–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π —Å —Ä–∞—Å—á–µ—Ç–æ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏—Ç–∞:
```typescript
interface PartialCloseResult {
  closedOrders: Order[];
  totalClosedQuantity: number;
  totalPnl: number;
  remainingLongSize: number;
}
```

### Order Indexing
–ö–∞–∂–¥—ã–π –ª–æ–Ω–≥ –æ—Ä–¥–µ—Ä –∏–º–µ–µ—Ç –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è:
```typescript
interface Order {
  // ...
  orderIndex?: number; // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –æ—Ä–¥–µ—Ä–æ–≤
}
```

### Dynamic Hedge Adjustment
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ö–µ–¥–∂–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏.

## üé™ –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

–§–∞–π–ª `test-strategy.js` –≤–∫–ª—é—á–∞–µ—Ç:
- –ö–æ–º–ø–ª–µ–∫—Å–Ω—É—é —Å–∏–º—É–ª—è—Ü–∏—é –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–Ω—ã
- –¢–µ—Å—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π EMA
- –ü—Ä–æ–≤–µ—Ä–∫—É –ª–æ–≥–∏–∫–∏ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—é —Ö–µ–¥–∂–∏—Ä–æ–≤–∞–Ω–∏—è

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —ç–º–æ–¥–∑–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞:
- üü¢ –û—Ç–∫—Ä—ã—Ç–∏–µ LONG
- üî¥ –û—Ç–∫—Ä—ã—Ç–∏–µ SHORT
- üíö –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–±—ã–ª—å–Ω–æ–≥–æ LONG
- üíú –ó–∞–∫—Ä—ã—Ç–∏–µ SHORT
- üõ°Ô∏è –û—Ç–∫—Ä—ã—Ç–∏–µ/–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ö–µ–¥–∂–∞
- üìä –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ
- üîÑ –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–π

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–î–æ—Å—Ç—É–ø–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∫–ª—é—á–∞–µ—Ç:
- –û–±—â–∏–π PnL
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ä–¥–µ—Ä–æ–≤ –ø–æ —Ç–∏–ø–∞–º
- –í–∏–Ω—Ä–µ–π—Ç
- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
- –ë–∞–ª–∞–Ω—Å—ã –∏ —ç–∫—Å–ø–æ–∑–∏—Ü–∏–∏
